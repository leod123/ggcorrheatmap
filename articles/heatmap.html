<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Making a heatmap • ggcorrheatmap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Making a heatmap">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggcorrheatmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/heatmap.html">Making a heatmap</a></li>
    <li><a class="dropdown-item" href="../articles/correlation.html">Correlation heatmaps</a></li>
    <li><a class="dropdown-item" href="../articles/annotation.html">Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/clustering.html">Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/mixed.html">Mixed layouts</a></li>
    <li><a class="dropdown-item" href="../articles/legends.html">Scales and legends</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/leod123/ggcorrheatmap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Making a heatmap</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/leod123/ggcorrheatmap/blob/main/vignettes/articles/heatmap.Rmd" class="external-link"><code>vignettes/articles/heatmap.Rmd</code></a></small>
      <div class="d-none name"><code>heatmap.Rmd</code></div>
    </div>

    
    
<p>The <code><a href="../reference/gghm.html">gghm()</a></code> function can be used to make a heatmap from a
matrix of data frame. Rows and columns are ordered the same way as in
the input.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leod123/ggcorrheatmap" class="external-link">ggcorrheatmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># For pasting together plots</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/heatmap-1.png" alt="A heatmap of the mtcars data with a colour scale going from dark blue to blue." width="700"></p>
<p>The <code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code> function uses <code><a href="../reference/gghm.html">gghm()</a></code> to
build a correlation heatmap. The correlations between the columns in the
input are computed and plotted.</p>
<p>If the matrix being plotted is symmetric, the axis labels are drawn
on the diagonal. This behaviour can be changed using the
<code>show_names_diag</code>, <code>show_names_x</code> and
<code>show_names_y</code> arguments. A symmetric heatmap can also be
plotted using triangular and mixed triangular layouts, explained more in
the <a href="correlation.html">correlation matrix</a> and <a href="mixed.html">mixed layouts</a> articles.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggcorrhm.html">ggcorrhm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/correlation%20heatmap-1.png" alt="A symmetric heatmap showing the Pearson correlation between columns in the mtcars data. Colours range from blue (low) to red (high). The names of the variables are displayed on the diagonal." width="700"></p>
<div class="section level2">
<h2 id="specifying-colours">Specifying colours<a class="anchor" aria-label="anchor" href="#specifying-colours"></a>
</h2>
<p>The colours of the heatmap can be adjusted by passing a string
specifying a Brewer or Viridis scale or a
<code>ggplot2::scale_fill_*</code> function call to the
<code>col_scale</code> argument. The limits can be changed by giving a
vector to the <code>limits</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the Viridis D (can also be "viridis") option</span></span>
<span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span>, col_scale <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-2-1.png" alt="A heatmap of the whole mtcars data using the viridis colour scale." width="700"></p>
<p>The <code>bins</code> argument creates a binned scale (only for
continuous data). If <code>bins</code> is a float number (class
‘double’), <code>ggplot2</code> will try to put the breaks at nice
numbers at the cost of changing the number of bins. If <code>bins</code>
is an integer the exact number of bins will instead be prioritised, but
the breaks may end up at strange numbers.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span>, col_scale <span class="op">=</span> <span class="st">"A"</span>, bins <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span>, col_scale <span class="op">=</span> <span class="st">"A"</span>, bins <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-3-1.png" alt="Two heatmaps of the mtcars data using the Viridis magma colour scale. The scale of the first plot is divided into five bins with breaks at 100, 200, 300, and 400. The second scale has six bins with breaks at 78.67, 157.33, 236.0, 314.67, and 393.33." width="700"></p>
<p>If the values in the input matrix are discrete a discrete scale will
be used. If the input is a data frame with mixed types (e.g. some
columns are character vectors and some numeric), the resulting heatmap
will be discrete.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Heatmap with discrete values</span></span>
<span><span class="co"># Border colour and linewidth can be changed using the `border_col` and `border_lwd` arguments</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">15</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     col_scale <span class="op">=</span> <span class="st">"Pastel2"</span>, border_col <span class="op">=</span> <span class="st">"thistle1"</span>,</span>
<span>     border_lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-4-1.png" alt="A heatmap of a 15 by 15 matrix filled randomly with a, b, and c. The Brewer Pastel2 palette is used for filling cells and the cell border colours have been changed to thistle1." width="700"></p>
<p>For <code><a href="../reference/gghm.html">gghm()</a></code> fill, colour and size legends are shown by
default. The legend order can be changed using the
<code>legend_order</code> argument. <code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code> tries to
hide some legends by default. Legends and scales are covered more in the
<a href="legends.html">scales and legends article</a>.</p>
</div>
<div class="section level2">
<h2 id="plotting-modes">Plotting modes<a class="anchor" aria-label="anchor" href="#plotting-modes"></a>
</h2>
<p>The <code>mode</code> argument takes a string and determines how the
values will be plotted. ‘heatmap’ or ‘hm’ gives the default heatmap,
‘text’ results in the values being written out, and any number from 1 to
25 changes the cells to the corresponding shapes (pch). There is also a
‘none’ mode which draws empty tiles.</p>
<p>In ‘text’ mode the text colour scales with the values in the cells.
Instead of <code>fill_scale</code>, use the <code>col_scale</code>
argument to set the scale.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">]</span>, mode <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>     <span class="co"># Viridis "A" ("magma")</span></span>
<span>     col_scale <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-5-1.png" alt="A heatmap of the first 15 rows of the mtcars data, where the cells have the values written inside instead of being filled. The colour of the text scales with the value." width="700"></p>
<p>In shape modes, 1-20 use colour scales and 21-25 use fill scales. The
sizes scale with the cell values and the scale can be customised by
passing <code>ggplot2::scale_size_*</code> functions to the
<code>size_scale</code> argument.</p>
<p>For fillable shapes the border colour and linewidth can be changed
using the <code>border_col</code> and <code>border_lwd</code>
arguments.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">]</span>, mode <span class="op">=</span> <span class="fl">22</span>,</span>
<span>     border_col <span class="op">=</span> <span class="st">"lightblue"</span>, border_lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     col_scale <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>     <span class="co"># The range argument sets the range of sizes to plot</span></span>
<span>     size_scale <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-6-1.png" alt="A heatmap of the first 15 rows of mtcars, where the cells have been substituted for stars (R pch 8). Both the size and colour scale with the value." width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">]</span>, mode <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-7-1.png" alt="A heatmap of the first 15 rows of mtcars. The cells are not filled, leaving only emptiness within the cell borders." width="700"></p>
</div>
<div class="section level2">
<h2 id="cell-borders">Cell borders<a class="anchor" aria-label="anchor" href="#cell-borders"></a>
</h2>
<p>Cell borders are by default grey, but can be removed by setting
<code>border_col</code> (border colour) or <code>border_lwd</code>
(border linewidth) to NA or <code>border_lty</code> (border linetype) to
0 (if <code>mode</code> is not a number) or <code>border_lwd</code> to 0
(if <code>mode</code> is a number).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the volcano data</span></span>
<span><span class="co"># It contains many rows and columns making the axes hard to read.</span></span>
<span><span class="co"># Can either turn off labels with `show_names_x` and `show_names_y`, or use</span></span>
<span><span class="co"># ggplot2::scale_x/y_discrete to change the labels</span></span>
<span><span class="co"># (keep in mind that the y label order is reversed in the default layout and that overwriting the scale can change the label positions)</span></span>
<span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">volcano</span>, col_scale <span class="op">=</span> <span class="st">"H"</span>,</span>
<span>     border_col <span class="op">=</span> <span class="cn">NA</span>, border_lwd <span class="op">=</span> <span class="fl">0</span>,</span>
<span>     show_names_x <span class="op">=</span> <span class="cn">FALSE</span>, show_names_y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-8-1.png" alt="A heatmap of the volcano R dataset using the viridis colour scale for filling cells. The cell borders have been removed." width="700"></p>
<p><code>border_col</code>, <code>border_lwd</code>, and
<code>border_lty</code> can take either values of length 1 or the same
length as the input data. Using the <code>return_data</code> argument to
get the plotting data makes it easier to implement conditional
customisation of borders.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Single values as input</span></span>
<span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, col_scale <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>             border_col <span class="op">=</span> <span class="st">"orange"</span>, border_lwd <span class="op">=</span> <span class="fl">1</span>, border_lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Two-step approach:</span></span>
<span><span class="co"># - Make a plot with the data of interest, retrieve the plotting data</span></span>
<span><span class="co"># - Make col, lwd, lty vectors based on some condition in the plotting data and pass to gghm</span></span>
<span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, return_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">plot_data</span></span>
<span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">plt_dat</span>,</span>
<span>                  <span class="co"># The plotting data contains the columns 'row', 'col', and 'value', so avoid those names</span></span>
<span>                  colr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">row</span> <span class="op">==</span> <span class="st">"hp"</span> <span class="op">~</span> <span class="st">"red"</span>, <span class="va">col</span> <span class="op">==</span> <span class="st">"vs"</span> <span class="op">~</span> <span class="st">"yellow"</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"grey"</span><span class="op">)</span>,</span>
<span>                  lwd <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">row</span> <span class="op">==</span> <span class="st">"hp"</span> <span class="op">|</span> <span class="va">col</span> <span class="op">==</span> <span class="st">"vs"</span> <span class="op">~</span> <span class="fl">1.5</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                  lty <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="fl">1</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, col_scale <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>             border_col <span class="op">=</span> <span class="va">plt_dat</span><span class="op">$</span><span class="va">colr</span>,</span>
<span>             border_lwd <span class="op">=</span> <span class="va">plt_dat</span><span class="op">$</span><span class="va">lwd</span>,</span>
<span>             border_lty <span class="op">=</span> <span class="va">plt_dat</span><span class="op">$</span><span class="va">lty</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make one figure with both plots using the patchwork package</span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-9-1.png" alt="Two correlation heatmaps of the mtcars data. Both use the viridis mako scale for filling cells. In the first plot the cell borders are thick, orange and dashed. In the second one, all cells where the row is hp are red and thick, cells wherer the column is vs are yellow and thick, and the rest are grey and thin. All cell borders are dashed." width="700"></p>
</div>
<div class="section level2">
<h2 id="handling-nas">Handling NAs<a class="anchor" aria-label="anchor" href="#handling-nas"></a>
</h2>
<p>NAs in the data can be removed using the <code>na_remove</code>
argument or set to a specific colour using the <code>na_col</code> and
<code>col_scale</code> arguments. Setting <code>na_remove</code> to
<code>TRUE</code> removes NAs from the plot, but they can still
interfere with clustering if a whole row or column is all NAs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Introduce NAs</span></span>
<span><span class="va">df_na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">df_na</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">df_na</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># With NAs and the default colour</span></span>
<span><span class="va">na_plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">df_na</span>, legend_order <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                <span class="co"># Darker borders for demonstration</span></span>
<span>                border_col <span class="op">=</span> <span class="st">"black"</span>, border_lwd <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NAs default"</span><span class="op">)</span></span>
<span><span class="co"># Colour NAs using scale function</span></span>
<span><span class="va">na_plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">df_na</span>, legend_order <span class="op">=</span> <span class="cn">NA</span>, show_names_y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                border_col <span class="op">=</span> <span class="st">"black"</span>, border_lwd <span class="op">=</span> <span class="fl">.3</span>,</span>
<span>                na_col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Change NA colour"</span><span class="op">)</span></span>
<span><span class="co"># Remove NAs, removes the border as well</span></span>
<span><span class="va">na_plt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">df_na</span>, legend_order <span class="op">=</span> <span class="cn">NA</span>, show_names_y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                border_col <span class="op">=</span> <span class="st">"black"</span>, border_lwd <span class="op">=</span> <span class="fl">.3</span>,</span>
<span>                na_remove <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NAs removed"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">na_plt1</span> <span class="op">+</span> <span class="va">na_plt2</span> <span class="op">+</span> <span class="va">na_plt3</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-10-1.png" alt="Three heatmaps of the mtcars data. 100 random cells have been changed to NA. In the first plot the NA cells are grey, in the second they are white In the last plot, NA cells are removed, leaving holes with no cell borders where there are NAs." width="624"></p>
</div>
<div class="section level2">
<h2 id="clustering-and-annotation">Clustering and annotation<a class="anchor" aria-label="anchor" href="#clustering-and-annotation"></a>
</h2>
<p>Clustering can be applied to the rows and columns using the
<code>cluster_rows</code> and <code>cluster_cols</code> arguments. See
the <a href="cluster.html">clustering</a> article for more on
clustering.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, cluster_rows <span class="op">=</span> <span class="cn">TRUE</span>, cluster_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/clustering-1.png" alt="A heatmap of mtcars, where rows and columns have been reordered according to hierarchical clustering results. Dendrograms are drawn to the right of and below the heatmap." width="700"></p>
<p>Row and column annotation is added by providing data frames to the
<code>annot_rows_df</code> and <code>annot_cols_df</code> arguments.
More details on annotation can be found in the <a href="annotation.html">annotation</a> article.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Make annotation data, use 15 rows for visibility</span></span>
<span><span class="va">row_annot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>,</span>
<span>                        a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">15</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">]</span>, annot_rows_df <span class="op">=</span> <span class="va">row_annot</span>, annot_rows_names_side <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/annotation-1.png" alt="Heatmap of mtcars with a thin column added to the right containing row annotation." width="700"></p>
<p>Clustering and annotation can of course be added simultaneously.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">]</span>, cluster_rows <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     annot_rows_df <span class="op">=</span> <span class="va">row_annot</span>, annot_rows_names_side <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-11-1.png" alt="Heatmap of mtcars. The rows have been clustered and along the right side is an annotation column with a dendrogram on its right." width="700"></p>
</div>
<div class="section level2">
<h2 id="cell-labels">Cell labels<a class="anchor" aria-label="anchor" href="#cell-labels"></a>
</h2>
<p>Cell labels can be displayed by using the <code>cell_labels</code>
argument which takes either a logical or a matrix or data frame. If
logical, the cell values are displayed. If a matrix/data frame, those
values are used instead. The matrix should contain the same row and
column names as the input, any rows or columns with different names or
cells with NAs will be silently dropped.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Make 5x5 matrix to plot with values between 1 and 10</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make label data with letters</span></span>
<span><span class="va">label_mat</span> <span class="op">&lt;-</span> <span class="va">plot_data</span></span>
<span><span class="va">label_mat</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="co"># Use a lighter scale for visibility</span></span>
<span><span class="va">fill_scl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>high <span class="op">=</span> <span class="st">"pink"</span>, low <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">plot_data</span>, col_scale <span class="op">=</span> <span class="va">fill_scl</span>, cell_labels <span class="op">=</span> <span class="cn">TRUE</span>, cell_label_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Using cell values"</span><span class="op">)</span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">plot_data</span>, col_scale <span class="op">=</span> <span class="va">fill_scl</span>, cell_labels <span class="op">=</span> <span class="va">label_mat</span>, cell_label_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Using external values"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-12-1.png" alt="Two 5x5 heatmaps with cells coloured by their values, going from 2 (white) to 10 (pink). The first heatmap has the numbers written in black text in each cell, while the second one has cells with one letter each, gonig from a to y starting in the top left and moving down each column." width="960"></p>
<p><code>cell_label_col</code>, <code>cell_label_size</code> and
<code>cell_label_digits</code> control the colours, sizes and number of
decimals (if numeric) of the labels. Keep in mind that data frames
passed to <code>cell_labels</code> are converted to matrices, so if the
data frame contains numbers and strings all numbers are converted to
strings and the numbers will not be rounded. In that case the numbers
can be rounded before being passed.</p>
<p>As mentioned before, the ‘text’ mode makes cells with text that
scales with cell values. If <code>cell_labels</code> is
<code>TRUE</code> or a matrix/data frame, the labels will be displayed
instead, meaning that user-supplied cell labels can have use colour
scale (also meaning that ‘text’ mode with <code>cell_labels</code> being
<code>FALSE</code> is the same as ‘text’ mode with
<code>cell_labels</code> as <code>TRUE</code>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">plot_data</span>, cell_labels <span class="op">=</span> <span class="cn">TRUE</span>, col_scale <span class="op">=</span> <span class="va">fill_scl</span>,</span>
<span>             cell_label_size <span class="op">=</span> <span class="fl">5</span>, cell_label_col <span class="op">=</span> <span class="st">"#63B8FF"</span>, cell_label_digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"size, colours, decimals"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Text requires colour instead of fill scale</span></span>
<span><span class="va">col_scl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradient</a></span><span class="op">(</span>high <span class="op">=</span> <span class="st">"pink"</span>, low <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="va">plot_data</span>, cell_labels <span class="op">=</span> <span class="va">label_mat</span>, mode <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>             col_scale <span class="op">=</span> <span class="va">col_scl</span>, cell_label_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'text' mode"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-13-1.png" alt="Two 5x5 heatmaps. The first one has coloured cells and a colour scale ranging from 2 (white) to 10 (pink). The values are written in the cells as blue numbers. The second heatmap has white cells, each with one letter written in pink (starting from a in the top right and going down each column, ending in y." width="960"></p>
</div>
<div class="section level2">
<h2 id="external-customisation">External customisation<a class="anchor" aria-label="anchor" href="#external-customisation"></a>
</h2>
<p>The plotting data can be returned by setting the
<code>return_data</code> argument to <code>TRUE</code>, allowing for
further customisation of e.g. cell labels by adding geoms to the
finished plot as shown below.</p>
<p>As explained in the ‘Cell borders’ section, arguments where the
values are passed on to <code>ggplot2::geom_*</code> functions can be
vectors with one value per cell. The drawing order can get a bit
confusing; for the full, top right and bottom left layouts the cells are
drawn from the top left moving down each column; by contrast, for top
left and bottom right layouts cells are drawn from the bottom left
moving up each column (due to the y-axis levels being reversed). The
rows are ordered in their drawing order in the data returned when
<code>return_data</code> is <code>TRUE</code> so that can be used as a
reference. However, in general, passing vectors to static aesthetics in
<code>ggplot2</code> can become tricky and adding another geom to the
output plot is more robust.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm.html">gghm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, return_data <span class="op">=</span> <span class="cn">TRUE</span>, border_col <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                  col_scale <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"deepskyblue"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add own labels based on value (also possible by supplying a matrix to cell_labels)</span></span>
<span><span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span><span class="op">$</span><span class="va">lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ntile.html" class="external-link">ntile</a></span><span class="op">(</span><span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span><span class="op">$</span><span class="va">value</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="va">plot_list</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">lab</span><span class="op">)</span>, <span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or maybe points (cell_labels uses `geom_text` so the asterisks would not be positioned in the middle of the cells)</span></span>
<span><span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span><span class="op">$</span><span class="va">lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span><span class="op">$</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span></span>
<span>                                  <span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1</span>, <span class="st">"*"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="va">plot_list</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">plot_list</span><span class="op">$</span><span class="va">plot_data</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lab</span><span class="op">)</span><span class="op">)</span>, shape <span class="op">=</span> <span class="st">"*"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/unnamed-chunk-14-1.png" alt="Two heatmaps of z-scores of mtcars. The colours are changed to a divergent scale going from blue to red. The first plot has had its cells labelled with numbers ranging from 1 to 5 based the cell value (1 is low, 5 is high). The second plot has asterisks in cells where the z-score is above 1 or below -1." width="672"></p>
<p>There are many arguments, allowing for quite some flexibility in the
heatmap layout. Most of the arguments are showcased in the articles,
hopefully they can be of some help. They go more into making <a href="correlation.html">correlation heatmaps</a>, <a href="clustering.html">clustering</a> and <a href="annotation.html">annotation</a>, making <a href="mixed.html">mixed
layout heatmaps</a>, and ways to deal with <a href="legends.html">legends</a>.</p>
</div>
<div class="section level2">
<h2 id="other-packages">Other packages<a class="anchor" aria-label="anchor" href="#other-packages"></a>
</h2>
<p>While <code>ggcorrheatmap</code> supports making general heatmaps, as
a heatmap package it is relatively lacking in features. The
<code>pheatmap</code> package and the <code>ComplexHeatmap</code>
package can be used for making heatmaps with many more options for
customisation (although not with <code>ggplot2</code>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Leo Dahl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

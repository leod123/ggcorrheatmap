<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using tidy data • ggcorrheatmap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using tidy data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggcorrheatmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/heatmap.html">Making a heatmap</a></li>
    <li><a class="dropdown-item" href="../articles/correlation.html">Correlation heatmaps</a></li>
    <li><a class="dropdown-item" href="../articles/annotation.html">Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/clustering.html">Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/facets.html">Facets</a></li>
    <li><a class="dropdown-item" href="../articles/mixed.html">Mixed layouts</a></li>
    <li><a class="dropdown-item" href="../articles/legends.html">Scales and legends</a></li>
    <li><a class="dropdown-item" href="../articles/tidy_input.html">Using tidy data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/leod123/ggcorrheatmap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using tidy data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/leod123/ggcorrheatmap/blob/v0.3.0/vignettes/articles/tidy_input.Rmd" class="external-link"><code>vignettes/articles/tidy_input.Rmd</code></a></small>
      <div class="d-none name"><code>tidy_input.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leod123/ggcorrheatmap" class="external-link">ggcorrheatmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>    <span class="co"># For converting between long and wide formats</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>Data is often in long format when working with <code>ggplot2</code>
and other functions in the <code>tidyverse</code>. The
<code><a href="../reference/gghm_tidy.html">gghm_tidy()</a></code> and <code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code> functions
provide a way to use the heatmap plotting functionality of
<code>ggcorrheatmap</code> with long format data. These functions (and
this article) assume that the user is familiar with the arguments of the
non-tidy versions of the functions.</p>
<div class="section level3">
<h3 id="heatmaps">Heatmaps<a class="anchor" aria-label="anchor" href="#heatmaps"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make some long format data using functions from</span></span>
<span><span class="co"># the dplyr, tidyr, tibble packages</span></span>
<span><span class="va">mtcars_long</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Move rownames into a column for long format conversion</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"cars"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">cars</span>, names_to <span class="op">=</span> <span class="st">"vars"</span>, values_to <span class="op">=</span> <span class="st">"vals"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mtcars_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   cars      vars    vals</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Mazda RX4 mpg    21   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Mazda RX4 cyl     6   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Mazda RX4 disp  160   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Mazda RX4 hp    110   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Mazda RX4 drat    3.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Mazda RX4 wt      2.62</span></span></code></pre></div>
<p>When using <code><a href="../reference/gghm_tidy.html">gghm_tidy()</a></code>, the names of the columns
containing the rows, columns, and values must be provided. These can be
unquoted, quoted, from variables, or indices.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">value_column</span> <span class="op">&lt;-</span> <span class="st">"vals"</span></span>
<span></span>
<span><span class="co"># Provide column names unquoted, as index, and from variable</span></span>
<span><span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">mtcars_long</span>, rows <span class="op">=</span> <span class="va">cars</span>, cols <span class="op">=</span> <span class="fl">2</span>, values <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">value_column</span>,</span>
<span>          <span class="co"># gghm arguments can be used (via ...)</span></span>
<span>          col_scale <span class="op">=</span> <span class="st">"A"</span>, scale_data <span class="op">=</span> <span class="st">"col"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-3-1.png" alt="A heatmap of the mtcars data. The columns have been scaled so values range between around -2 to 3. The Viridis magma scale is used for the cell colours." width="700"></p>
<p>Columns containing annotations and cell labels can be specified in
the same way.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make sure the annotations are unique</span></span>
<span><span class="co"># (i.e. one row or column does not have two different annotation values)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">row_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>,</span>
<span>                      a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>,</span>
<span>                      b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>,</span>
<span>                      c <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>,</span>
<span>                      d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mtcars_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add the row and column annotations</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">row_key</span>, by <span class="op">=</span> <span class="st">"cars"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">col_key</span>, by <span class="op">=</span> <span class="st">"vars"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add labels</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>labs <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>, labels <span class="op">=</span> <span class="va">labs</span>,</span>
<span>            annot_rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, annot_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">d</span><span class="op">)</span>,</span>
<span>            <span class="co"># gghm arguments</span></span>
<span>            legend_order <span class="op">=</span> <span class="fl">1</span>, cell_label_col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>            cell_label_digits <span class="op">=</span> <span class="fl">0</span>, col_scale <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>            scale_data <span class="op">=</span> <span class="st">"col"</span>, cell_label_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>            cluster_rows <span class="op">=</span> <span class="cn">TRUE</span>, cluster_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-4-1.png" alt="A heatmap of mtcars with scaled columns. Rows and columns are clustered and each dimension has one continuous and one discrete annotation. The cells are coloured with the Viridis magma scale and are labelled by integers from 1 to 352." width="768"></p>
<p>When introducing gaps the <code>facet_rows</code> and
<code>facet_cols</code> arguments allow for facet membership
specification using columns in the input. It is still possible to
specify the splits with the <code>split_rows</code> and
<code>split_cols</code> arguments for the same behaviour as in
<code><a href="../reference/gghm.html">gghm()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="va">mtcars_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Use the annotations as facets</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">row_key</span>, by <span class="op">=</span> <span class="st">"cars"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">col_key</span>, by <span class="op">=</span> <span class="st">"vars"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Change facet order for rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">b</span>, levels <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>            facet_rows <span class="op">=</span> <span class="va">b</span>, facet_cols <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">mtcars_long</span>,</span>
<span>                  <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>                  split_rows <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                  split_cols <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-5-1.png" alt="Two mtcars heatmaps. The first one has two row splits and one column split with facet labels, and the rows and column are in a different order from the raw data. The second heatmap has one row and one column split with no facet labels." width="700"></p>
</div>
<div class="section level3">
<h3 id="correlation-heatmaps">Correlation heatmaps<a class="anchor" aria-label="anchor" href="#correlation-heatmaps"></a>
</h3>
<p><code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code> is the tidy version of
<code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code>, although not all of the functionality is
available. By default, the input is assumed to contain correlation
coefficients (<code>cor_in</code> is <code>TRUE</code>). If
<code>cor_in</code> is <code>FALSE</code> the behaviour changes and some
arguments work differently.</p>
<p>The <code><a href="../reference/cor_long.html">cor_long()</a></code> function can be used to calculate
correlations from long format data. By default the output is in wide
format and can be passed to <code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggcorrhm.html">ggcorrhm</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/cor_long.html">cor_long</a></span><span class="op">(</span><span class="va">mtcars_long</span>, <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>, out_format <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span>,</span>
<span>  <span class="co"># Specify that the input contains correlation values</span></span>
<span>  cor_in <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-6-1.png" alt="A correlation heatmap of the mtcars data, with colours going from blue (-1) to white (0) to red (1). Names are written along the diagonal." width="700"></p>
<p>If desired, the correlation data can be returned in long format,
which can be given to <code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code> to make a
heatmap.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cor_long.html">cor_long</a></span><span class="op">(</span><span class="va">mtcars_long</span>, <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>                       out_format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Can also be done using tidyverse functions, something like</span></span>
<span><span class="co"># mtcars_long %&gt;%</span></span>
<span><span class="co">#   pivot_wider(id_cols = "cars", names_from = "vars", values_from = "vals") %&gt;%</span></span>
<span><span class="co">#   column_to_rownames("cars") %&gt;%</span></span>
<span><span class="co">#   cor() %&gt;%</span></span>
<span><span class="co">#   # This part only needed if output should be long format</span></span>
<span><span class="co">#   as.data.frame() %&gt;%</span></span>
<span><span class="co">#   rownames_to_column("row") %&gt;%</span></span>
<span><span class="co">#   pivot_longer(cols = -row, names_to = "col")</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mtcars_cor</span><span class="op">)</span></span>
<span><span class="co">#&gt;    row col      value</span></span>
<span><span class="co">#&gt; 1  mpg mpg  1.0000000</span></span>
<span><span class="co">#&gt; 2  cyl mpg -0.8521620</span></span>
<span><span class="co">#&gt; 3 disp mpg -0.8475514</span></span>
<span><span class="co">#&gt; 4   hp mpg -0.7761684</span></span>
<span><span class="co">#&gt; 5 drat mpg  0.6811719</span></span>
<span><span class="co">#&gt; 6   wt mpg -0.8676594</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">mtcars_cor</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-8-1.png" alt="A correlation heatmap of the mtcars data, with colours going from blue (-1) to white (0) to red (1). Names are written along the diagonal." width="700"></p>
<p>It is also possible to correlate two different matrices.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make another long format data</span></span>
<span><span class="va">iris_long</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># The dimensions of the two matrices must be compatible</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">32</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Make unique names for the rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html" class="external-link">make.names</a></span><span class="op">(</span><span class="va">Species</span>, unique <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>species <span class="op">=</span> <span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Convert to long format</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">species</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   species  name         value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> setosa   Sepal.Length   5.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> setosa   Sepal.Width    3.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> setosa   Petal.Length   1.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> setosa   Petal.Width    0.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> setosa.1 Sepal.Length   4.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> setosa.1 Sepal.Width    3</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlate the two long format matrices</span></span>
<span><span class="va">mi_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cor_long.html">cor_long</a></span><span class="op">(</span><span class="va">iris_long</span>, <span class="va">species</span>, <span class="va">name</span>, <span class="va">value</span>,</span>
<span>                   <span class="co"># The first one ends up in the rows and</span></span>
<span>                   <span class="co"># the second in the columns</span></span>
<span>                   <span class="va">mtcars_long</span>, <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>                   out_format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mi_cor</span><span class="op">)</span></span>
<span><span class="co">#&gt;            row col        value</span></span>
<span><span class="co">#&gt; 1 Sepal.Length mpg  0.000136181</span></span>
<span><span class="co">#&gt; 2  Sepal.Width mpg -0.162115780</span></span>
<span><span class="co">#&gt; 3 Petal.Length mpg  0.242985583</span></span>
<span><span class="co">#&gt; 4  Petal.Width mpg -0.052943516</span></span>
<span><span class="co">#&gt; 5 Sepal.Length cyl -0.107232949</span></span>
<span><span class="co">#&gt; 6  Sepal.Width cyl  0.166560421</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">mi_cor</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-11-1.png" alt="A heatmap showing correlations between the columns in mtcars (in the columns) and the columns iris (in the rows, excluding the Species column)." width="672"></p>
<p>If the <code>cor_in</code> argument is <code>FALSE</code>,
<code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code> will calculate the correlations instead.
Both options come with limitations.</p>
<p><code>cor_in</code> is <code>FALSE</code>:</p>
<ul>
<li><p>Cannot correlate two different matrices.</p></li>
<li><p><code>annot_rows</code> and <code>annot_cols</code> require
different thinking as both will use the names from the column specified
as <code>cols</code>.</p></li>
<li><p>The <code>labels</code> argument works like in
<code><a href="../reference/gghm.html">gghm()</a></code>, taking a combination of TRUE and FALSE or a (wide
format) matrix or data frame (and, additionally, NULL).</p></li>
</ul>
<p><code>cor_in</code> is <code>TRUE</code>:</p>
<ul>
<li><p>Requires the correlation values to be pre-computed.</p></li>
<li><p>As all correlation calculations are skipped, p-values will not be
computed and will also need to be calculated in advance. The
<code><a href="../reference/cor_long.html">cor_long()</a></code> function can help with this.</p></li>
<li><p>The <code>labels</code> argument works like in
<code><a href="../reference/gghm_tidy.html">gghm_tidy()</a></code>, taking a column in the data.</p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Give the non-correlation data</span></span>
<span><span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">mtcars_long</span>, <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>              cor_in <span class="op">=</span> <span class="cn">FALSE</span>, labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-12-1.png" alt="mtcars correlation matrix, with the correlation values written in the cells (apart from the diagonal that has the column names)." width="700"></p>
<p>Like with <code><a href="../reference/gghm_tidy.html">gghm_tidy()</a></code>, <code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code> can
take arguments from <code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code> for extra customisation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Annotation</span></span>
<span><span class="va">cor_annot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>,</span>
<span>                        annot1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">11</span>, annot2 <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">1</span>,</span>
<span>                        annot3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">11</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                        annot4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">11</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mtcars_cor_extra</span> <span class="op">&lt;-</span> <span class="va">mtcars_cor</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add row annotations</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cor_annot</span>, <span class="va">.names</span>, <span class="va">annot1</span>, <span class="va">annot3</span><span class="op">)</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row"</span> <span class="op">=</span> <span class="st">".names"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add column annotations</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cor_annot</span>, <span class="va">.names</span>, <span class="va">annot2</span>, <span class="va">annot4</span><span class="op">)</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"col"</span> <span class="op">=</span> <span class="st">".names"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add labels</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>labs <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mtcars_cor_extra</span><span class="op">)</span></span>
<span><span class="co">#&gt;    row col      value annot1 annot3 annot2 annot4 labs</span></span>
<span><span class="co">#&gt; 1  mpg mpg  1.0000000      1      a     11      A    1</span></span>
<span><span class="co">#&gt; 2  cyl mpg -0.8521620      2      a     11      A    2</span></span>
<span><span class="co">#&gt; 3 disp mpg -0.8475514      3      b     11      A    3</span></span>
<span><span class="co">#&gt; 4   hp mpg -0.7761684      4      a     11      A    4</span></span>
<span><span class="co">#&gt; 5 drat mpg  0.6811719      5      a     11      A    5</span></span>
<span><span class="co">#&gt; 6   wt mpg -0.8676594      6      a     11      A    6</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">mtcars_cor_extra</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span>,</span>
<span>              annot_rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">annot1</span>, <span class="va">annot3</span><span class="op">)</span>,</span>
<span>              annot_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">annot2</span>, <span class="va">annot4</span><span class="op">)</span>,</span>
<span>              labels <span class="op">=</span> <span class="va">labs</span>,</span>
<span>              cluster_rows <span class="op">=</span> <span class="cn">TRUE</span>, cluster_cols <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tl"</span>, <span class="st">"br"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hm"</span>, <span class="st">"hm"</span><span class="op">)</span>,</span>
<span>              col_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"G"</span><span class="op">)</span>, cell_label_col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>              legend_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-14-1.png" alt="mtcars correlation matrix with clustered rows and columns. There are two row and two column annotations as well. The heatmap has the diagonal going from the bottom left to the top right. The top left triangle uses the Viridis magma colour scale and the bottom right triangle the mako scale. Cells are marked with integers between 2 and 120, with the diagonal showing column names instead. Only the two heatmap legends are shown (not the annotation legends)." width="700"></p>
</div>
<div class="section level2">
<h2 id="cell-labels-and-mixed-layouts">Cell labels and mixed layouts<a class="anchor" aria-label="anchor" href="#cell-labels-and-mixed-layouts"></a>
</h2>
<p>When adding cell labels in <code><a href="../reference/gghm_tidy.html">gghm_tidy()</a></code>, if the value
column and cell label column are the same the cell labels will be
affected by the <code>scale_data</code> argument.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">mtcars_long</span>, <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>          labels <span class="op">=</span> <span class="va">vals</span>, scale_data <span class="op">=</span> <span class="st">"col"</span>,</span>
<span>          cell_label_digits <span class="op">=</span> <span class="fl">0</span>, cell_label_col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-15-1.png" alt="A heatmap of the mtcars data with scaled columns. The cells are labelled with the cell values, rounded to integers." width="700"></p>
<p>It is also convenient to make conditional cell labels when the data
is in long format, such as using different labels depending on the cell
values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>labs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&lt;</span> <span class="fl">1.5</span> <span class="op">~</span> <span class="st">"-"</span>,</span>
<span>                          <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">"+"</span>,</span>
<span>                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">species</span>, <span class="va">value</span>, labels <span class="op">=</span> <span class="va">labs</span>,</span>
<span>            col_scale <span class="op">=</span> <span class="st">"A"</span>, cell_label_col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-16-1.png" alt="A heatmap of the first 32 rows of the iris dataset, transposed to a 4x32 matrix. The cells are coloured with the Viridis magma colour scale and labelled with + at high values or - at low values, or nothing in-between." width="672"></p>
<p>When working with mixed layouts, <code><a href="../reference/gghm.html">gghm()</a></code> can take care of
labelling only one half of the heatmap. Since the tidy version just uses
the values in the specified <code>labels</code> column, a bit more work
is required.</p>
<p>For convenience, the <code><a href="../reference/add_mixed_layout.html">add_mixed_layout()</a></code> helper function
can add a column showing which values will end up in which triangle of a
mixed layout to help with labelling cells.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get long format data</span></span>
<span><span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">a</span>, names_to <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add column saying which triangle each value is in</span></span>
<span>  <span class="fu"><a href="../reference/add_mixed_layout.html">add_mixed_layout</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="va">a</span>, cols <span class="op">=</span> <span class="va">b</span>, values <span class="op">=</span> <span class="va">value</span>,</span>
<span>                   layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tl"</span>, <span class="st">"br"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   a     b      value layout</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1     1     -<span style="color: #BB0000;">1</span>     tl    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1     2     -<span style="color: #BB0000;">0.929</span> br    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1     3     -<span style="color: #BB0000;">0.857</span> br    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1     4     -<span style="color: #BB0000;">0.786</span> br    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1     5     -<span style="color: #BB0000;">0.714</span> br    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1     6     -<span style="color: #BB0000;">0.643</span> br</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add labels only for the top left part</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">layout</span> <span class="op">==</span> <span class="st">"tl"</span>, <span class="st">"+"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gghm_tidy.html">gghm_tidy</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">value</span>, labels <span class="op">=</span> <span class="va">label</span>,</span>
<span>            <span class="co"># Make sure to use the same layout as in add_mixed_layout</span></span>
<span>            <span class="co"># to avoid confusion</span></span>
<span>            layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tl"</span>, <span class="st">"br"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hm"</span>, <span class="st">"hm"</span><span class="op">)</span>,</span>
<span>            col_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G"</span>, <span class="st">"A"</span><span class="op">)</span>, cell_label_col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-18-1.png" alt="A heatmap of a symmetric 15x15 matrix with values ranging between -1 and 1 in a gradient from the bottom left to the top right along the diagonal. The top left triangle uses the Viridis mako colour scale with cells labelled with +. The bottom right triangle uses the magma colours and has no labels. " width="700"></p>
<p><code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code> works similarly if <code>cor_in</code>
is <code>TRUE</code>. If <code>FALSE</code>, the <code>labels</code>
argument works like in <code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code>, taking a wide format
matrix/data frame or a combination of <code>TRUE</code> and
<code>FALSE</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `cor_in` is `TRUE`</span></span>
<span><span class="va">mtcars_cor</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add layout column</span></span>
<span>  <span class="fu"><a href="../reference/add_mixed_layout.html">add_mixed_layout</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bl"</span>, <span class="st">"tr"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add cell labels</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lab <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">layout</span> <span class="op">==</span> <span class="st">"tr"</span>, <span class="va">value</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span>, labels <span class="op">=</span> <span class="va">lab</span>,</span>
<span>                cor_in <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bl"</span>, <span class="st">"tr"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hm"</span>, <span class="st">"hm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-19-1.png" alt="mtcars correlation matrix. The top right triangle is marked with correlation values. The bottom left triangle has no labels." width="700"></p>
</div>
<div class="section level2">
<h2 id="p-values">P-values<a class="anchor" aria-label="anchor" href="#p-values"></a>
</h2>
<p>In <code><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy()</a></code>, if <code>cor_in</code> is
<code>FALSE</code>, the <code>p_values</code> argument works like in
<code><a href="../reference/ggcorrhm.html">ggcorrhm()</a></code> and can deal with mixed layouts.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">mtcars_long</span>, <span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>, cor_in <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tl"</span>, <span class="st">"br"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hm"</span>, <span class="st">"hm"</span><span class="op">)</span>,</span>
<span>              labels <span class="op">=</span> <span class="cn">TRUE</span>, p_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>              <span class="co"># P-values top left, correlation values bottom right</span></span>
<span>              cell_label_p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-20-1.png" alt="mtcars correlation matrix with diagonal running from the bottom left to the top right. The cells in the top left triangle are labelled with p-values and asterisks while the cells in the bottom right triangle are marked with correlation values." width="700"></p>
<p>If <code>cor_in</code> is <code>TRUE</code>, the labels are drawn
directly from a column in the data, which means that the labels have to
be made in advance. To help with this, the <code>cor_long</code>
function has some extra p-value functionality.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/cor_long.html">cor_long</a></span><span class="op">(</span><span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>,</span>
<span>           out_format <span class="op">=</span> <span class="st">"long"</span>,</span>
<span>           p_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           <span class="co"># Multiple testing adjustment</span></span>
<span>           p_adjust <span class="op">=</span> <span class="st">"bonferroni"</span>,</span>
<span>           <span class="co"># Thresholds for symbols based on adjusted p-values</span></span>
<span>           p_thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"***"</span> <span class="op">=</span> <span class="fl">0.001</span>, <span class="st">"**"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"*"</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>           <span class="co"># 'p_sym_add' takes a column and adds to the symbols for quick combining</span></span>
<span>           <span class="co"># One of 'values', 'p_val', and 'p_adj'</span></span>
<span>           p_sym_add <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>           <span class="co"># 'p_sym_digits' changes the number of decimals</span></span>
<span>           <span class="co"># displayed in the p_sym</span></span>
<span>           p_sym_digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># The output contains the columns 'row', 'col', 'value',</span></span>
<span>  <span class="co"># 'p_val', 'p_adj', and 'p_sym'</span></span>
<span>  <span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span>, labels <span class="op">=</span> <span class="va">p_sym</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-21-1.png" alt="mtcars correlation matrix with p-value labels with asterisks in both triangles. " width="700"></p>
<p>Combine this with <code>add_mixed_layout</code> for more control in
mixed layouts. Below is an example of showing unadjusted and adjusted
p-values in different triangles of the heatmap.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt_dat</span> <span class="op">&lt;-</span> <span class="va">mtcars_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add p-values</span></span>
<span>  <span class="fu"><a href="../reference/cor_long.html">cor_long</a></span><span class="op">(</span><span class="va">cars</span>, <span class="va">vars</span>, <span class="va">vals</span>, out_format <span class="op">=</span> <span class="st">"long"</span>,</span>
<span>           p_values <span class="op">=</span> <span class="cn">TRUE</span>, p_adjust <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add layout</span></span>
<span>  <span class="fu"><a href="../reference/add_mixed_layout.html">add_mixed_layout</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tr"</span>, <span class="st">"bl"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Make custom labels with adjusted p-values in the</span></span>
<span>  <span class="co"># top right and unadjusted in the bottom left</span></span>
<span>  <span class="co"># but only display if &lt; 0.05</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>labs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">layout</span> <span class="op">==</span> <span class="st">"tr"</span> <span class="op">&amp;</span> <span class="va">p_adj</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">p_adj</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          <span class="va">layout</span> <span class="op">==</span> <span class="st">"bl"</span> <span class="op">&amp;</span> <span class="va">p_val</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">p_val</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span>, labels <span class="op">=</span> <span class="va">labs</span>,</span>
<span>                cor_in <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="va">plt_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Make symbol labels instead</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>p_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/symnum.html" class="external-link">symnum</a></span><span class="op">(</span><span class="va">p_val</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"***"</span>, <span class="st">"**"</span>, <span class="st">"*"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         p_adj_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/symnum.html" class="external-link">symnum</a></span><span class="op">(</span><span class="va">p_adj</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+++"</span>, <span class="st">"++"</span>, <span class="st">"+"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         labs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">layout</span> <span class="op">==</span> <span class="st">"tr"</span> <span class="op">&amp;</span> <span class="va">p_adj</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="va">p_adj_star</span>,</span>
<span>                          <span class="va">layout</span> <span class="op">==</span> <span class="st">"bl"</span> <span class="op">&amp;</span> <span class="va">p_val</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="va">p_star</span>,</span>
<span>                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ggcorrhm_tidy.html">ggcorrhm_tidy</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">value</span>, labels <span class="op">=</span> <span class="va">labs</span>,</span>
<span>                cor_in <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt1</span> <span class="op">+</span> <span class="va">plt2</span></span></code></pre></div>
<p><img src="tidy_input_files/figure-html/unnamed-chunk-22-1.png" alt="Two mtcars correlation heatmaps. The first one has p-values in the cells. Only p-values below 0.05 are shown, and the bottom left triangle shows unadjusted p-values while the top right triangle shows adjusted p-values (being slightly higher). The second plot has swapped the p-values for asterisks in the bottom left triangle and pluses in the top right triangle." width="960"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Leo Dahl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
